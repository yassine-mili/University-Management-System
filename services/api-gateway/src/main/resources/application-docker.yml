spring:
  # Redis Configuration for Docker
  data:
    redis:
      host: redis
      port: 6379
      timeout: 2000ms

  cloud:
    gateway:
      routes:
        - id: auth-service
          uri: http://auth-service:8081
          predicates:
            - Path=/api/auth/**
          filters:
            - name: RewritePath
              args:
                regexp: /api/auth/(?<remaining>.*)
                replacement: /api/v1/auth/${remaining}
            - name: CircuitBreaker
              args:
                name: authService
                fallbackUri: forward:/fallback/auth
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                redis-rate-limiter.requestedTokens: 1

        - id: student-service
          uri: http://student-service:8082
          predicates:
            - Path=/api/students/**
          filters:
            - name: AuthenticationFilter
            - name: RewritePath
              args:
                regexp: /api/students/(?<remaining>.*)
                replacement: /api/v1/students/${remaining}
            - name: CircuitBreaker
              args:
                name: studentService
                fallbackUri: forward:/fallback/student
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                redis-rate-limiter.requestedTokens: 1

        - id: courses-service
          uri: http://courses-service:8083
          predicates:
            - Path=/api/courses/**
          filters:
            - StripPrefix=1
            - name: CircuitBreaker
              args:
                name: coursesService
                fallbackUri: forward:/fallback/courses
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                redis-rate-limiter.requestedTokens: 1

        - id: grades-service
          uri: http://grades-service:8084
          predicates:
            - Path=/api/grades/**
          filters:
            - name: AuthenticationFilter
            - name: RewritePath
              args:
                regexp: /api/grades/(?<remaining>.*)
                replacement: /api/v1/grades/${remaining}
            - name: CircuitBreaker
              args:
                name: gradesService
                fallbackUri: forward:/fallback/grades
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                redis-rate-limiter.requestedTokens: 1

        - id: billing-service
          uri: http://billing-service:5000
          predicates:
            - Path=/api/billing/**
          filters:
            - name: AuthenticationFilter
            - StripPrefix=2
            - name: AddResponseHeader
              args:
                name: Access-Control-Allow-Origin
                value: "*"
            - name: AddResponseHeader
              args:
                name: Access-Control-Allow-Headers
                value: "*"
            - name: AddResponseHeader
              args:
                name: Access-Control-Allow-Methods
                value: "GET,POST,OPTIONS"
            - name: CircuitBreaker
              args:
                name: billingService
                fallbackUri: forward:/fallback/billing
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 5
                redis-rate-limiter.burstCapacity: 10
                redis-rate-limiter.requestedTokens: 1

logging:
  level:
    org.springframework.cloud.gateway: INFO
    com.universite.gateway: INFO
